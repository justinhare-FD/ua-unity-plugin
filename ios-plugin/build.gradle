import java.util.regex.Pattern

task clean(type: Delete) {
    delete "$buildDir/unity-plugin"
}

task build << {
    // Copy the plugin src
    copy {
        from file("src")
        into file("$buildDir/unity-plugin/Assets/Plugins/iOS")
    }

    // Copy the plugin editor
    copy {
        from file("editor")
        into file("$buildDir/unity-plugin/Assets/Editor")
    }

     // Copy the airshipconfig.properties
    copy {
        from file("AirshipConfig-template.plist")
        into file("$buildDir/unity-plugin/Assets/Plugins/iOS")
        rename "AirshipConfig-template.plist", "AirshipConfig.plist"

        if (shouldSwapKeys)
        {
          filter { String line ->
              line.replaceAll(Pattern.quote("APP_KEY"), appKey)
                  .replaceAll(Pattern.quote("APP_SECRET"), appSecret)
          }
        }
    }
}

build.dependsOn("clean")
